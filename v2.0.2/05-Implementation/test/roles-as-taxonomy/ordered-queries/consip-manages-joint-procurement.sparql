 # Story: I want to see the buyers managed by CONSIP for a given procedure

PREFIX : <http://example.org/test-abox#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>
PREFIX epo: <http://data.europa.eu/a4g/ontology/core#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX rt: <http://data.europa.eu/a4g/ontology/cv/roles-taxonomy#>

SELECT DISTINCT ?procedure ?roleObj ?role ?agent FROM :
WHERE {
    
    {
     ?pev a epo:ProcurementEvent ;
         :involvesProcedure ?procedureObject ;
	     :involvesPeriod ?period ;
    	 :involvesAgentRole ?roleObj .
    ?procedureObject epo:title ?procedure ;
                     epo:eppi ?eppi .
    FILTER (?roleObj = rt:buy_ca && ?eppi = "http://<http://data.europa.eu/a4g/eppi/112101")
    }
    { 
        ?pev a epo:ProcurementEvent ;
             :involvesAgent ?agentObj .
        ?agentObj skos:prefLabel ?agent .
    }
    UNION
    {
        ?pev a epo:ProcurementEvent ;
             :involvesAgentRole ?cpb .
        FILTER (?cpb = rt:pm_cpb)
    }
}
